var kanfeidie = {
    class: "subway-map",
    columns: 17,
    rows: 17,
    cellSize: 60,
    legendId: "legend",
    textClass: "text",
    gridNumbers: "false",
    grid: "false",
    lineWidth: "10",
    lines: [
        {
            label: "下界交通主干道",
            color: "#007bff",
            stations: [
                {
                    name: "SM55的家",
                    x: -310,
                    z: -355,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "S"
                },
                {
                    name: false,
                    x: -310,
                    z: -94,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "The World305蜘蛛刷怪笼",
                    x: -259,
                    z: -94,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "S"
                },
                {
                    name: false,
                    x: -259,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "Luotian的交易市场",
                    x: 18,
                    z: 42,
                    repx: false,
                    repz: 47,
                    marker: "interchange",
                    labelPos: "S"
                },
                {
                    name: false,
                    x: 94,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "挂机基地",
                    x: 94,
                    z: 32,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "S"
                }
            ]
        },
        {
            label: "Chara路",
            color: "#28a745",
            stations: [
                {
                    name: "Chara路口",
                    x: -241,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "E"
                },
                {
                    name: "Chara angel 的家✨",
                    x: -241,
                    z: 88,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "S"
                }
            ]
        },
        {
            label: "冰岛路",
            color: "#17a2b8",
            stations: [
                {
                    name: "冰岛路口",
                    x: -81,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "S"
                },
                {
                    name: false,
                    x: -81,
                    z: 4,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "Wangs121的家✨",
                    x: -91,
                    z: 4,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "W"
                },
                {
                    name: false,
                    x: -81,
                    z: 4,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "下界要塞入口",
                    x: -86,
                    z: -1,
                    repx: -81,
                    repz: false,
                    marker: "station",
                    labelPos: "S"
                },
                {
                    name: "UnkemptSphere64'home",
                    x: -81,
                    z: -9,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                },
                {
                    name: false,
                    x: -81,
                    z: -28,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "浮冰采集区",
                    x: -108,
                    z: -28,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "E"
                }
            ]
        },
        {
            label: "尖啸路",
            color: "#dc3545",
            stations: [
                {
                    name: "juju家",
                    x: -40,
                    z: 61,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "W"
                },
                {
                    name: "啊妙的交易市场",
                    x: -42,
                    z: 45,
                    repx: -38,
                    repz: 47,
                    marker: "interchange",
                    labelPos: "N"
                },
                {
                    name: "啊妙的家",
                    x: -39,
                    z: 42,
                    repx: -38,
                    repz: 47,
                    marker: "interchange",
                    labelPos: "S"
                },
                {
                    name: "尖啸之门✨",
                    x: -38,
                    z: 12,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                }
            ]
        },
        {
            label: "硬核路",
            color: "#d39b00",
            stations: [
                {
                    name: "PlainiVulpes 一个坑",
                    x: 74,
                    z: 155,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                },
                {
                    name: false,
                    x: 74,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "硬核路口",
                    x: 80,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "W"
                },
                {
                    name: "HaxtCant的硬核家",
                    x: 80,
                    z: 15,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                }
            ]
        },
        {
            label: "Hot路",
            color: "pink",
            stations: [
                {
                    name: "|",
                    x: -18,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "S"
                },
                {
                    name: "HotMinecraft616的家",
                    x: -18,
                    z: 16,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                }
            ]
        },
        {
            label: "WS路",
            color: "#333",
            stations: [
                {
                    name: "|",
                    x: 0,
                    z: 47,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: "W"
                },
                {
                    name: "wbreezefeatherw sweetestzzx 合租的家",
                    x: 0,
                    z: 42,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "W"
                },
                {
                    name: false,
                    x: 0,
                    z: 19,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: false,
                    x: 4,
                    z: 19,
                    repx: false,
                    repz: false,
                    marker: "station",
                    labelPos: false
                },
                {
                    name: "啊妙的新家✨",
                    x: 4,
                    z: -43,
                    repx: false,
                    repz: false,
                    marker: "interchange",
                    labelPos: "E"
                }
            ]
        }
    ]
}

/**
 * 现行坐标转换规则：
 * (-z坐标/100+2)*3  作为data-coords第一个参数
 * (x坐标+400)/100*3 作为data-coords第二个参数
 * @param {*} x 坐标x
 * @param {*} z 坐标z
 * @returns "para1,para2"字符串
 */
function getCoords(x, z) {
    let para1 = (-z / 100 + 2) * 3
    let para2 = (x + 400) / 100 * 3
    return `${para1},${para2}`
}

$(function () {
    $(".map-area").append(`<div class="${kanfeidie.class}" data-columns="${kanfeidie.columns}" data-rows="${kanfeidie.rows}" data-cellSize="${kanfeidie.cellSize}" data-legendId="${kanfeidie.legendId}" data-textClass="${kanfeidie.textClass}" data-gridNumbers="${kanfeidie.gridNumbers}" data-grid="${kanfeidie.grid}" data-lineWidth="${kanfeidie.lineWidth}">`)
    $(".map-area").append(`<div id="legend"></div>`)
    let lines = kanfeidie.lines
    for (let li = 0; li < lines.length; li++) {
        $(`.${kanfeidie.class}`).append(`<ul data-color="${lines[li].color}" data-label="${lines[li].label}" class="line${li}"></ul>`)
        let stations = lines[li].stations
        for (let si = 0; si < stations.length; si++) {
            let station = stations[si]
            if (station.repx == undefined || station.repx == false) {
                station.repx = station.x
            }
            if (station.repz == undefined || station.repz == false) {
                station.repz = station.z
            }
            if (station.marker == "interchange") {
                $(`.line${li}`).append(`<li data-coords="${getCoords(station.repx,station.repz)}" data-marker="${station.marker}" data-labelPos="${station.labelPos}">${station.name} (${station.x},${station.z})</li>`)
            } else if (station.marker == "station") {
                if (station.name == undefined || station.name == false) {
                    station.name = ""
                }
                if (station.labelPos == undefined || station.labelPos == false) {
                    station.labelPos = "E"
                }
                $(`.line${li}`).append(`<li data-coords="${getCoords(station.repx,station.repz)}" data-marker="${station.marker}" data-labelPos="${station.labelPos}">${station.name}</li>`)
            }
        }
    }
    
    $(`.${kanfeidie.class}`).subwayMap({ debug: true });
})